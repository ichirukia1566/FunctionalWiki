<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Create New Page</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script>
$(document).ready(function () {
	var type, code, saveFilename, loadFilename, placeholderName;
	var prevPageURL = unescape(document.referrer);
	var prevPageTitle = prevPageURL.substr(prevPageURL.lastIndexOf('/') + 1);
	//alert(prevPageTitle);
	if (prevPageTitle != '') {
		type = "load";
		loadFilename = prevPageTitle;
		code = "";
		$.post("http://fyp15026s1.cs.hku.hk/create",{t: type,c: code, n: loadFilename}, function(data) {
        	if(data != '') {
            	$("#code").val(data);
          	} else {
          		$("#code").val('');
          		$("#saveName").val(prevPageTitle);
          	}
     	});
	}
	var height_c = $("#content").height();
	if (height_c > 160) { 
		$("#sidebar").height(height_c); // if the content is too long, expand the sidebar height
	}
	
	$("#save").click(function() {
		type = "save";
      	code = $("#code").val();
      	saveFilename = $("#saveName").val();
      	$.post("http://fyp15026s1.cs.hku.hk/create",{t: type, c: code, n: saveFilename}, function(data) {
        	if(data === 'done') {
            	alert("save success");
          	} else {
          		alert("save failure");
          	}
     	});
    });
    $("#load").click(function() {
      	type = "load";
      	loadFilename=$("#loadName").val();
      	code = "";
      	$.post("http://fyp15026s1.cs.hku.hk/create",{t: type,c: code, n: loadFilename}, function(data) {
        	if(data != '') {
            	$("#code").val(data);
          	} else {
          		alert("load failure");
          	}
     	});
    });
    $("#preview").click(function() {
    	type = "preview";
    	placeholderName = "newpage";
    	code = $("#code").val();
    	$.post("http://fyp15026s1.cs.hku.hk/create",{t: type,c: code, n: placeholderName}, function(data) {
        	$("#output").val(data);
     	});
    });
});
</script>
<link rel="stylesheet" type="text/css" href="css/styles.css">
</head>
<body>
	<section class="container">
		<div id="sidebar" class="sidebar1">
			<a href="/Main Page"><img src="images/logo.png" align="middle"></a>
			<ul>
				<li><a href="/create">Create new page</a></li>
				<li><a href="/factorial">Factorial</a></li>
				<li><a href="/overflow">Overflow</a></li>
			<ul>
		</div>
		<div id="content" class="content">
			<div class="innerContent">
				<h1>Create New Page</h1><hr>
				<table>
    				<tr>
      					<td rowspan="3">
        					<textarea id="code" cols="50" rows="25">#code#&#13;&#10;apply_style ([style "color" "darkolivegreen", style "font-weight" "bold"]) (text "Darkolivegreen bold text!")&#13;&#10;#end#
        					</textarea>
      					</td>
      					<td>
        					<td align="center"><textarea id="saveName"></textarea><br><button type="button" id="save">Save</button></td>
      					</td>
      					<td rowspan="3">
        					<textarea readonly="readonly" id="output" cols = "50" rows="25"></textarea>
      					</td>
				    </tr>
				    <tr>
				      	<td></td>
				      	<td align="center"><textarea id="loadName"></textarea><br><button type="button" id="load">Load</button></td>
				      	<td></td>
				    </tr>
				    <tr>
				      	<td></td>
				      	<td align="center"><button type="button" id="preview">Preview</button></td>
				      	<td></td>
				    </tr>
				</table>
			</div>
		</div>
	</section>
	<footer class="container1">
		<p>Copyright &copy; The Functional Wiki. All rights reserved.</p>
	</footer>
</body>
</html>