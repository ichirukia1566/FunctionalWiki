<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Editing </title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script>
$(document).ready(function () {
        var name = decodeURIComponent(location.search.replace('?', ''));
        if (name === '') {
            alert('No article name specified. Going back');
            window.history.back();
        }
        $(".name").text(name);
        var type, code, placeholderName;
        type = "load";
        code = "";
        $.post("/create",{t: type,c: code, n: name}, function(data) {
            if(data != '') {
                $("#code").val(data);
            } else {
                $("#code").val('');
            }
        });
	
	var height_c = $("#content").height();
	if (height_c > 160) { 
		$("#sidebar").height(height_c); // if the content is too long, expand the sidebar height
	}
	
	$("#save").click(function() {
		type = "save";
      	code = $("#code").val();
      	$.post("/create",{t: type, c: code, n: name}, function(data) {
        	if(data === 'done') {
            	alert("save success");
          	} else {
          		alert("save failure");
          	}
     	});
    });
    $("#load").click(function() {
      	type = "load";
      	code = "";
      	$.post("/create",{t: type,c: code, n: name}, function(data) {
        	if(data != '') {
            	$("#code").val(data);
          	} else {
          		alert("load failure");
          	}
     	});
    });
    $("#preview").click(function() {
    	type = "preview";
        // use a name which is unlikely to clash
    	placeholderName = "SKFDAL3jh4k2h4kaSF<AJ#$@Q$#@!";
    	code = $("#code").val();
    	$.post("/create",{t: type,c: code, n: placeholderName}, function(data) {
        	$("#output").val(data);
     	});
    });
});
</script>
<link rel="stylesheet" type="text/css" href="css/styles.css">
</head>
<body>
	<section class="container">
		<div id="sidebar" class="sidebar1">
			<a href="/Main Page"><img src="images/logo.png" align="middle"></a>
			<ul>
				<li><a href="/create">Create new page</a></li>
				<li><a href="/factorial">Factorial</a></li>
				<li><a href="/overflow">Overflow</a></li>
			<ul>
		</div>
		<div id="content" class="content">
			<div class="innerContent">
                            <h1>Editing <span class="name"></span></h1><hr>
				<table>
    				<tr>
      					<td rowspan="3">
        					<textarea id="code" cols="50" rows="25">#code#&#13;&#10;apply_style ([style "color" "darkolivegreen", style "font-weight" "bold"]) (text "Darkolivegreen bold text!")&#13;&#10;#end#
        					</textarea>
      					</td>
      					<td>
        					<td align="center"><button type="button" id="save">Save</button></td>
      					</td>
      					<td rowspan="3">
        					<textarea readonly="readonly" id="output" cols = "50" rows="25"></textarea>
      					</td>
				    </tr>
				    <tr>
				      	<td></td>
				      	<td align="center"><button type="button" id="load">Load</button></td>
				      	<td></td>
				    </tr>
				    <tr>
				      	<td></td>
				      	<td align="center"><button type="button" id="preview">Preview</button></td>
				      	<td></td>
				    </tr>
				</table>
			</div>
		</div>
	</section>
	<footer class="container1">
		<p>Copyright &copy; The Functional Wiki. All rights reserved.</p>
	</footer>
</body>
</html>
